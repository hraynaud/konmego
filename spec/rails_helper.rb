# This file is copied to spec/ when you run 'rails generate rspec:install'
require 'spec_helper'
ENV['RAILS_ENV'] ||= 'test'
require File.expand_path('../config/environment', __dir__)
# Prevent database truncation if the environment is production
abort('The Rails environment is running in production mode!') if Rails.env.production?
require 'rspec/rails'
# Add additional requires below this line. Rails is not loaded until this point!

# Requires supporting ruby files with custom matchers and macros, etc, in
# spec/support/ and its subdirectories. Files matching `spec/**/*_spec.rb` are
# run as spec files by default. This means that files in spec/support that end
# in _spec.rb will both be required and run as specs, causing the specs to be
# run twice. It is recommended that you do not name files matching this glob to
# end with _spec.rb. You can configure this pattern with the --pattern
# option on the command line or in ~/.rspec, .rspec or `.rspec-local`.
#
# The following line is provided for convenience purposes. It has the downside
# of increasing the boot-up time by auto-requiring all files in the support
# directory. Alternatively, in the individual `*_spec.rb` files, manually
# require only the support files necessary.
#
Dir[Rails.root.join('spec', 'support', '**', '*.rb')].each { |f| require f }
# ActiveRecord::Migration.maintain_test_schema!
# Checks for pending migrations and applies them before tests are run.
# If you are not using ActiveRecord, you can remove these lines.

RSpec.configure do |config|
  # Remove this line if you're not using ActiveRecord or ActiveRecord fixtures

  # If you're not using ActiveRecord, or you'd prefer not to run each of your
  # examples within a transaction, remove the following line or assign false
  # instead of true.
  config.use_transactional_fixtures = true

  # RSpec Rails can automatically mix in different behaviours to your tests
  # based on their file location, for example enabling you to call `get` and
  # `post` in specs under `spec/controllers`.
  #
  # You can disable this behaviour by removing the line below, and instead
  # explicitly tag your specs with their type, e.g.:
  #
  #     RSpec.describe UsersController, :type => :controller do
  #       # ...
  #     end
  #
  # The different available types are documented in the features, such as in
  # https://relishapp.com/rspec/rspec-rails/docs
  config.infer_spec_type_from_file_location!

  # Filter lines from Rails gems in backtraces.
  config.filter_rails_from_backtrace!
  # arbitrary gems may also be filtered via:
  # config.filter_gems_from_backtrace("gem name")
  #
  config.include TestUtils
  config.include TestUtils::RSpec

  config.before(:each) do
    allow(OllamaService).to receive(:embedding).and_return(
      [0.23635555803775787,
       -0.13871708512306213,
       0.1111939325928688,
       0.16381265223026276,
       0.22693997621536255,
       -0.0750085711479187,
       0.16809403896331787,
       -0.3651520311832428,
       -0.0036324625834822655,
       0.0956527441740036,
       -0.049253419041633606,
       -0.37677016854286194,
       -0.32859349250793457,
       0.11381521821022034,
       -0.2662627100944519,
       -0.07651706039905548,
       -0.1730148047208786,
       -0.029785562306642532,
       -0.08323293924331665,
       0.06219774857163429,
       -0.3191072344779968,
       0.10462009161710739,
       0.025293957442045212,
       0.35565435886383057,
       -0.10277135670185089,
       -0.011994658038020134,
       -0.2678696811199188,
       0.04663686826825142,
       -0.022588029503822327,
       -0.09339475631713867,
       -0.06632724404335022,
       0.08460221439599991,
       0.174371600151062,
       0.13145501911640167,
       -0.28988608717918396,
       0.13290810585021973,
       0.1558927297592163,
       -0.2125699669122696,
       0.034376755356788635,
       -0.039896462112665176,
       -0.009835764765739441,
       -0.32241472601890564,
       0.13434149324893951,
       -0.11528189480304718,
       -0.019908152520656586,
       0.08875395357608795,
       -0.11406586319208145,
       -0.10763605684041977,
       0.13236582279205322,
       0.09531327337026596,
       -0.30171748995780945,
       -0.2364625334739685,
       -0.3614124059677124,
       0.010063646361231804,
       0.17468899488449097,
       0.413411021232605,
       0.16941052675247192,
       -0.24959269165992737,
       -0.008311832323670387,
       -0.2745882272720337,
       0.19469158351421356,
       0.02847340703010559,
       -0.2609630823135376,
       0.32781779766082764,
       -0.21493054926395416,
       0.1161825880408287,
       -0.3723115622997284,
       -0.03340612351894379,
       0.2718563675880432,
       -0.1291348934173584,
       0.15105578303337097,
       -0.013942942023277283,
       0.09172840416431427,
       0.2398487776517868,
       0.031060712411999702,
       0.011215776205062866,
       -0.05774755775928497,
       -0.08662912994623184,
       0.3478356599807739,
       -0.17463985085487366,
       0.016542453318834305,
       -0.14745615422725677,
       -0.11115461587905884,
       0.013117106631398201,
       0.10178190469741821,
       -0.14429140090942383,
       -0.14355044066905975,
       -0.18655160069465637,
       -0.07377731055021286,
       -0.16758449375629425,
       -0.11874862015247345,
       -0.13824337720870972,
       -0.045762255787849426,
       -0.04078042507171631,
       -0.025062695145606995,
       0.19000180065631866,
       0.06266758590936661,
       -0.18029536306858063,
       -0.030913183465600014,
       0.17111973464488983,
       -0.08851445466279984,
       -0.1328503042459488,
       -0.03706727921962738,
       0.20318478345870972,
       -0.07835422456264496,
       -0.019073553383350372,
       -0.2022489458322525,
       -0.1942962408065796,
       0.11342062056064606,
       0.005309190601110458,
       -0.12443061172962189,
       0.024980928748846054,
       0.004455821588635445,
       0.11611273139715195,
       0.15699973702430725,
       0.031627774238586426,
       -0.25159215927124023,
       0.004513413645327091,
       0.04991019517183304,
       0.1893390268087387,
       0.21583488583564758,
       0.15142974257469177,
       0.012828705832362175,
       -0.06998483091592789,
       0.2738792300224304,
       0.027949277311563492,
       -0.13468316197395325,
       -2.5216344818694772e-33,
       0.274635374546051,
       -0.17315244674682617,
       0.07423004508018494,
       0.003605501726269722,
       0.21269823610782623,
       0.11010020971298218,
       -0.18237875401973724,
       0.03225500136613846,
       0.036607593297958374,
       -0.14413070678710938,
       0.17307284474372864,
       0.17091882228851318,
       -0.16537107527256012,
       0.14750367403030396,
       0.4464329779148102,
       -0.07119107246398926,
       0.15101498365402222,
       0.12479793280363083,
       -0.027693625539541245,
       -0.09626074135303497,
       -0.14590248465538025,
       -0.01139381155371666,
       -0.09772425144910812,
       0.0614091157913208,
       0.2054118514060974,
       -0.13770073652267456,
       0.00891181081533432,
       -0.33172208070755005,
       -0.11184340715408325,
       0.17786924540996552,
       0.20770150423049927,
       -0.05746973678469658,
       -0.2106669396162033,
       0.07368423044681549,
       -0.1357715129852295,
       -0.3148691654205322,
       -0.02000415325164795,
       -0.22622551023960114,
       -0.07430130243301392,
       0.1967650055885315,
       0.14403469860553741,
       -0.05509434640407562,
       0.0481254905462265,
       -0.11436159908771515,
       -0.0432041697204113,
       0.008462587371468544,
       0.01081965584307909,
       0.3294840455055237,
       -0.059210505336523056,
       0.36154547333717346,
       0.26590806245803833,
       -0.22736987471580505,
       0.0693536326289177,
       -0.3343976140022278,
       0.1487918198108673,
       0.11321564018726349,
       0.02071286179125309,
       0.014865824021399021,
       -0.21169093251228333,
       -0.20095692574977875,
       0.07850011438131332,
       -0.08854767680168152,
       0.24306334555149078,
       -0.25523313879966736,
       0.29567840695381165,
       -0.10755954682826996,
       -0.06330421566963196,
       0.15705811977386475,
       -0.25506696105003357,
       0.10399092733860016,
       -0.22734227776527405,
       0.09886600077152252,
       -0.2066875547170639,
       -0.1553824245929718,
       -0.11550341546535492,
       0.07888734340667725,
       0.06993930786848068,
       0.005889074876904488,
       0.04876958578824997,
       -0.1839628517627716,
       -0.09236013889312744,
       0.18005968630313873,
       0.07621268928050995,
       -0.00921302568167448,
       -0.30566760897636414,
       -0.15416891872882843,
       0.09025250375270844,
       -0.13446246087551117,
       0.17791178822517395,
       -0.142499178647995,
       0.01758608967065811,
       0.21951690316200256,
       -0.025782743468880653,
       -0.14328348636627197,
       -0.3618089556694031,
       -1.6826904085013494e-33,
       -0.21821773052215576,
       -0.15546345710754395,
       -0.11459755897521973,
       0.19098800420761108,
       0.00610253494232893,
       0.09692735224962234,
       -0.18392813205718994,
       -0.08832002431154251,
       0.1473505198955536,
       -0.001600397750735283,
       -0.4680025577545166,
       0.10673744976520538,
       0.07666687667369843,
       -0.2674248218536377,
       -0.06914091110229492,
       -0.132237046957016,
       0.028359288349747658,
       0.003445945680141449,
       0.04653552919626236,
       -0.029062077403068542,
       0.07456168532371521,
       -0.09553311765193939,
       -0.038735531270504,
       -0.29900550842285156,
       0.029388274997472763,
       0.1035066545009613,
       0.10569146275520325,
       -0.0766557902097702,
       -0.1183943971991539,
       -0.02696412429213524,
       0.0647919625043869,
       -0.0038929544389247894,
       0.09907698631286621,
       -0.03720127046108246,
       -0.005977819673717022,
       0.3086370825767517,
       0.4809795618057251,
       -0.14475370943546295,
       -0.2181372195482254,
       -0.0928063690662384,
       0.10320867598056793,
       0.21086445450782776,
       0.16954272985458374,
       -0.17333102226257324,
       0.03495152294635773,
       -0.14019720256328583,
       -0.1285911500453949,
       0.29262223839759827,
       -0.1756223440170288,
       0.022056978195905685,
       0.10356083512306213,
       -0.09756559878587723,
       0.0465124174952507,
       0.12659952044487,
       -0.07034976035356522,
       0.07724297791719437,
       0.17643384635448456,
       0.11959121376276016,
       0.09488797187805176,
       -0.08441206067800522,
       0.08696991205215454,
       -0.07354606688022614,
       -0.03323434293270111,
       0.3535449504852295,
       -0.061489105224609375,
       0.0008142795413732529,
       -0.15248918533325195,
       0.14255580306053162,
       -0.12039913237094879,
       0.010153872892260551,
       0.08456353843212128,
       -0.06914221495389938,
       -0.21561726927757263,
       0.011322859674692154,
       -0.018990114331245422,
       0.3429132103919983,
       0.29597365856170654,
       -0.2143084853887558,
       0.1433546394109726,
       0.12576961517333984,
       0.04881804436445236,
       -0.24121123552322388,
       0.19220419228076935,
       0.09846161305904388,
       -0.10736626386642456,
       -0.1753685474395752,
       -0.08315322548151016,
       0.11665650457143784,
       0.14651328325271606,
       0.03757169097661972,
       -0.028943199664354324,
       0.050385981798172,
       0.004720756784081459,
       -0.059190619736909866,
       0.22276818752288818,
       -9.956397661881056e-08,
       0.011721529066562653,
       0.05231381580233574,
       -0.014250492677092552,
       0.1430577039718628,
       0.16662032902240753,
       -0.02575831115245819,
       0.07261393964290619,
       -0.271920382976532,
       0.06705942749977112,
       0.05011775717139244,
       -0.08684399724006653,
       -0.15803778171539307,
       0.07288522273302078,
       0.10810630023479462,
       0.40801507234573364,
       -0.24484574794769287,
       0.20456261932849884,
       0.08737613260746002,
       -0.219709113240242,
       0.33639276027679443,
       -0.0066687073558568954,
       0.22232571244239807,
       0.0024928851053118706,
       -0.17542850971221924,
       0.05705457180738449,
       -0.3024962544441223,
       -0.16566261649131775,
       0.10075077414512634,
       0.1816391944885254,
       0.17827317118644714,
       -0.2013159841299057,
       0.34595179557800293,
       0.04757130891084671,
       -0.33326324820518494,
       -0.07419481873512268,
       0.02109694294631481,
       -0.10436229407787323,
       -0.0900244191288948,
       0.1691344678401947,
       0.003979973495006561,
       0.15894830226898193,
       0.11544660478830338,
       -0.0962551012635231,
       0.035261768847703934,
       0.08235500007867813,
       -0.06997518241405487,
       0.2969975471496582,
       -0.33388659358024597,
       0.04152768477797508,
       -0.012757870368659496,
       0.03858361020684242,
       0.06123289465904236,
       0.418668657541275,
       0.03291235491633415,
       -0.27477332949638367,
       0.14068937301635742,
       0.00891139917075634,
       0.008657359518110752,
       0.05829710513353348,
       -0.12082666158676147,
       0.03720245510339737,
       0.12602858245372772,
       -0.016812480986118317,
       0.19567041099071503]
    )
    allow(OllamaService).to receive(:completion).and_return('this is a completion')
  end

  config.after(:each) do
  end
end
